<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Analysis_and_optimization__Dataflow_utils (stanc.Analysis_and_optimization__Dataflow_utils)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">stanc</a> &#x00BB; Analysis_and_optimization__Dataflow_utils</nav><h1>Module <code>Analysis_and_optimization__Dataflow_utils</code></h1></header><dl><dt class="spec value" id="val-union_maps_left"><a href="#val-union_maps_left" class="anchor"></a><code><span class="keyword">val</span> union_maps_left : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> Core_kernel.Map.Poly.t</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> Core_kernel.Map.Poly.t</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> Core_kernel.Map.Poly.t</span></code></dt><dd><p>Union maps, preserving the left element in a collision</p></dd></dl><dl><dt class="spec value" id="val-build_cf_graphs"><a href="#val-build_cf_graphs" class="anchor"></a><code><span class="keyword">val</span> build_cf_graphs : <span>?&#8288;flatten_loops:bool</span> <span>&#45;&gt;</span> <span>?&#8288;blocks_after_body:bool</span> <span>&#45;&gt;</span> <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><span>(<a href="../Middle__Expr/Typed/index.html#type-t">Middle.Expr.Typed.t</a>, <a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>)</span> <a href="../Middle__Stmt/Fixed/Pattern/index.html#type-t">Middle.Stmt.Fixed.Pattern.t</a></span> * <span class="type-var">'m</span>)</span> Core_kernel.Map.Poly.t</span> <span>&#45;&gt;</span> <span><a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a> Core_kernel.Set.Poly.t</span> * <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a> Core_kernel.Set.Poly.t</span>)</span> Core_kernel.Map.Poly.t</span> * <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a> Core_kernel.Set.Poly.t</span>)</span> Core_kernel.Map.Poly.t</span></code></dt><dd><p>Simultaneously builds the controlflow parent graph, the predecessor graph and the exit set of a statement. It's advantageous to build them together because they both rely on some of the same Break, Continue and Return bookkeeping.</p><p>Takes a statement map and returns the triple: (exit set, predecessor graph, controlflow parent graph) where * (exit set, predecessor graph) is the return value of build_predecessor_graph * (controlflow parent graph) is the return value of build_cf_graph</p></dd></dl><dl><dt class="spec value" id="val-build_cf_graph"><a href="#val-build_cf_graph" class="anchor"></a><code><span class="keyword">val</span> build_cf_graph : <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><span>(<a href="../Middle__Expr/Typed/index.html#type-t">Middle.Expr.Typed.t</a>, <a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>)</span> <a href="../Middle__Stmt/Fixed/Pattern/index.html#type-t">Middle.Stmt.Fixed.Pattern.t</a></span> * <span class="type-var">'m</span>)</span> Core_kernel.Map.Poly.t</span> <span>&#45;&gt;</span> <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a> Core_kernel.Set.Poly.t</span>)</span> Core_kernel.Map.Poly.t</span></code></dt><dd><p>Building the controlflow graph requires a traversal with state that includes continues, breaks, returns and the controlflow graph accumulator. The traversal should be a branching traversal with set unions rather than a forward traversal because continue and return statements shouldn't affect other branches of execution.</p></dd></dl><dl><dt class="spec value" id="val-build_predecessor_graph"><a href="#val-build_predecessor_graph" class="anchor"></a><code><span class="keyword">val</span> build_predecessor_graph : <span>?&#8288;flatten_loops:bool</span> <span>&#45;&gt;</span> <span>?&#8288;blocks_after_body:bool</span> <span>&#45;&gt;</span> <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><span>(<a href="../Middle__Expr/Typed/index.html#type-t">Middle.Expr.Typed.t</a>, <a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>)</span> <a href="../Middle__Stmt/Fixed/Pattern/index.html#type-t">Middle.Stmt.Fixed.Pattern.t</a></span> * <span class="type-var">'m</span>)</span> Core_kernel.Map.Poly.t</span> <span>&#45;&gt;</span> <span><a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a> Core_kernel.Set.Poly.t</span> * <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a> Core_kernel.Set.Poly.t</span>)</span> Core_kernel.Map.Poly.t</span></code></dt><dd><p>Building the predecessor graph requires a traversal with state that includes the current previous nodes and the predecessor graph accumulator. Special cases are made for loops, because they should include the body exits as predecessors to the body, and they should include loop predecessors in their exit sets. I'm not sure if the single re-traversal of the loop body is sufficient or this requires finding a fixed-point.</p></dd></dl><dl><dt class="spec value" id="val-build_recursive_statement"><a href="#val-build_recursive_statement" class="anchor"></a><code><span class="keyword">val</span> build_recursive_statement : <span>(<span><span>(<span class="type-var">'e</span>, <span class="type-var">'s</span>)</span> <a href="../Middle__Stmt/Fixed/Pattern/index.html#type-t">Middle.Stmt.Fixed.Pattern.t</a></span> <span>&#45;&gt;</span> <span class="type-var">'m</span> <span>&#45;&gt;</span> <span class="type-var">'s</span>)</span> <span>&#45;&gt;</span> <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><span>(<span class="type-var">'e</span>, <a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>)</span> <a href="../Middle__Stmt/Fixed/Pattern/index.html#type-t">Middle.Stmt.Fixed.Pattern.t</a></span> * <span class="type-var">'m</span>)</span> Core_kernel.Map.Poly.t</span> <span>&#45;&gt;</span> <a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a> <span>&#45;&gt;</span> <span class="type-var">'s</span></code></dt><dd><p>Build a fixed-point data type representation of a statement given a label-map representation.</p></dd></dl><dl><dt class="spec value" id="val-is_ctrl_flow"><a href="#val-is_ctrl_flow" class="anchor"></a><code><span class="keyword">val</span> is_ctrl_flow : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Middle__Stmt/Fixed/Pattern/index.html#type-t">Middle.Stmt.Fixed.Pattern.t</a></span> <span>&#45;&gt;</span> bool</code></dt><dd><p>Check if the statement controls the execution of its substatements.</p></dd></dl><dl><dt class="spec value" id="val-merge_set_maps"><a href="#val-merge_set_maps" class="anchor"></a><code><span class="keyword">val</span> merge_set_maps : <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'b</span> Core_kernel.Set.Poly.t</span>)</span> Core_kernel.Map.Poly.t</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'b</span> Core_kernel.Set.Poly.t</span>)</span> Core_kernel.Map.Poly.t</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'b</span> Core_kernel.Set.Poly.t</span>)</span> Core_kernel.Map.Poly.t</span></code></dt><dd><p>Merge two maps whose values are sets, and union the sets when there's a collision.</p></dd></dl><dl><dt class="spec value" id="val-generate_map"><a href="#val-generate_map" class="anchor"></a><code><span class="keyword">val</span> generate_map : <span><span class="type-var">'a</span> Core_kernel.Set.Poly.t</span> <span>&#45;&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> Core_kernel.Map.Poly.t</span></code></dt><dd><p>Generate a Map by applying a function to each element of a key set.</p></dd></dl><dl><dt class="spec value" id="val-build_statement_map"><a href="#val-build_statement_map" class="anchor"></a><code><span class="keyword">val</span> build_statement_map : <span>(<span class="type-var">'s</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'e</span>, <span class="type-var">'s</span>)</span> <a href="../Middle__Stmt/Fixed/Pattern/index.html#type-t">Middle.Stmt.Fixed.Pattern.t</a></span>)</span> <span>&#45;&gt;</span> <span>(<span class="type-var">'s</span> <span>&#45;&gt;</span> <span class="type-var">'m</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'s</span> <span>&#45;&gt;</span> <span><span>(<a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>, <span><span>(<span class="type-var">'e</span>, <a href="../Analysis_and_optimization/Dataflow_types/index.html#type-label">Analysis_and_optimization.Dataflow_types.label</a>)</span> <a href="../Middle__Stmt/Fixed/Pattern/index.html#type-t">Middle.Stmt.Fixed.Pattern.t</a></span> * <span class="type-var">'m</span>)</span> Core_kernel.Map.Poly.t</span></code></dt><dd><p>The statement map is built by traversing substatements recursively to replace substatements with their labels while building up the substatements' statement maps. Then, the result is the union of the substatement maps with this statement's singleton pair, which is expressed in terms of the new label-containing statement.</p></dd></dl></div></body></html>